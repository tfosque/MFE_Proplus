"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.serveStatic = void 0;
const path_1 = __importDefault(require("path"));
const koa_static_1 = __importDefault(require("koa-static"));
// serveStatic is not supposed to be used to serve a folder that have sub-folders
const serveStatic = (filesDir, koaStaticOptions = {}) => {
    const serve = (0, koa_static_1.default)(filesDir, koaStaticOptions);
    // eslint-disable-next-line @typescript-eslint/ban-types
    const middleware = async (ctx, next) => {
        const prev = ctx.path;
        const newPath = path_1.default.basename(ctx.path);
        ctx.path = newPath;
        await serve(ctx, async () => {
            ctx.path = prev;
            await next();
            ctx.path = newPath;
        });
        ctx.path = prev;
    };
    return middleware;
};
exports.serveStatic = serveStatic;
//# sourceMappingURL=serve-static.js.map