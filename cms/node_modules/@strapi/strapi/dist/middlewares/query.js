"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.query = void 0;
const qs_1 = __importDefault(require("qs"));
const defaults = {
    strictNullHandling: true,
    arrayLimit: 100,
    depth: 20,
};
/**
 * Body parser hook
 */
const addQsParser = (app, settings) => {
    Object.defineProperty(app.request, 'query', {
        configurable: false,
        enumerable: true,
        /*
         * Get parsed query-string.
         */
        get() {
            const qstr = this.querystring;
            this._querycache = this._querycache || {};
            const cache = this._querycache;
            if (!cache[qstr]) {
                cache[qstr] = qs_1.default.parse(qstr, settings);
            }
            return cache[qstr];
        },
        /*
         * Set query-string as an object.
         */
        set(obj) {
            this.querystring = qs_1.default.stringify(obj);
        },
    });
    return app;
};
const query = (config, { strapi }) => {
    addQsParser(strapi.server.app, { ...defaults, ...config });
};
exports.query = query;
//# sourceMappingURL=query.js.map