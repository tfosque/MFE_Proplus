"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const fp_1 = require("lodash/fp");
// @ts-expect-error
const passport_local_1 = require("passport-local");
const createLocalStrategy = (strapi, middleware) => {
    return new passport_local_1.Strategy({
        usernameField: 'email',
        passwordField: 'password',
        session: false,
    }, (email, password, done) => {
        return (
        // @ts-expect-error
        strapi.admin.services.auth
            .checkCredentials({ email: (0, fp_1.toLower)(email), password })
            // @ts-expect-error
            .then(async ([error, user, message]) => {
            if (middleware) {
                return middleware([error, user, message], done);
            }
            return done(error, user, message);
        })
            // @ts-expect-error
            .catch((error) => done(error)));
    });
};
exports.default = createLocalStrategy;
//# sourceMappingURL=local-strategy.js.map