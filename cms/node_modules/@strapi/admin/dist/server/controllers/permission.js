"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const permission_1 = require("../validation/permission");
const utils_1 = require("../utils");
const formatters_1 = require("./formatters");
exports.default = {
    /**
     * Check each permissions from `request.body.permissions` and returns an array of booleans
     * @param {KoaContext} ctx - koa context
     */
    async check(ctx) {
        const { body: input } = ctx.request;
        const { userAbility } = ctx.state;
        await (0, permission_1.validateCheckPermissionsInput)(input);
        const { engine } = (0, utils_1.getService)('permission');
        const checkPermissionsFn = engine.checkMany(userAbility);
        ctx.body = {
            data: checkPermissionsFn(input.permissions),
        };
    },
    /**
     * Returns every permissions, in nested format
     * @param {KoaContext} ctx - koa context
     */
    async getAll(ctx) {
        const { sectionsBuilder, actionProvider, conditionProvider } = (0, utils_1.getService)('permission');
        const actions = actionProvider.values();
        const conditions = conditionProvider.values();
        const sections = await sectionsBuilder.build(actions);
        ctx.body = {
            data: {
                conditions: (0, formatters_1.formatConditions)(conditions),
                sections,
            },
        };
    },
};
//# sourceMappingURL=permission.js.map